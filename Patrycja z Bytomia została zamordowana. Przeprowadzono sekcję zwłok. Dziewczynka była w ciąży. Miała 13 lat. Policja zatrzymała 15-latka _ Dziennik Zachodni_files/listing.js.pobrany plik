!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=97)}({0:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(1),s=(o=a)&&o.__esModule?o:{default:o};var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.className=n,this.props={},this.ui={},this.events={},this.el={},this.elExists={}}return r(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.ui=this.defineUi(),this.events=this.defineEvents(),this.props=this.defineProps(),i(this.props,e),this.node=""!==this.id?document.getElementById(this.id):document;var t=new s.default(this);t.bindComponentElements(),t.bindComponentEvents(),this.afterInit()}},{key:"afterInit",value:function(){}},{key:"defineUi",value:function(){return{}}},{key:"defineEvents",value:function(){return{}}},{key:"defineProps",value:function(){return{}}}]),e}();t.default=u},1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.component=t}return o(e,[{key:"bindComponentElements",value:function(){if(0!==Object.keys(this.component.ui).length){var e=void 0,t=void 0;for(e in this.component.ui)this.component.ui.hasOwnProperty(e)&&("#"===(t=this.component.ui[e]).charAt(0)&&-1===t.indexOf(" ")?(this.component.el[e]=document.getElementById(t.substring(1)),this.component.elExists[e]=!!this.component.el[e]):(this.component.el[e]=this.component.node?this.component.node.querySelectorAll(t):null,this.component.elExists[e]=!!(this.component.el[e]&&this.component.el[e].length>0)))}}},{key:"bindComponentEvents",value:function(){if(0!==Object.keys(this.component.events).length){var e=void 0,t=void 0,n=void 0,o=void 0,i=void 0;for(e in this.component.events)if(this.component.events.hasOwnProperty(e)){if(n=e.split(" ")[0],o=e.split(" ")[1],i=this.component.events[e],!(t=void 0!==o&&this.component.el.hasOwnProperty(o)?this.component.el[o]:this.component.node))continue;if(this.isNodeList(t)){var r=void 0;for(r in t)t.hasOwnProperty(r)&&t[r].addEventListener(n,this.component[i].bind(this.component))}else t.addEventListener(n,this.component[i].bind(this.component))}}}},{key:"isNodeList",value:function(e){var t=Object.prototype.toString.call(e);return/^\[object (HTMLCollection|NodeList|Object)\]$/.test(t)}}]),e}();t.default=i},2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"ajax",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise(function(r,a){var s=new XMLHttpRequest;s.open(t,e);var u={"X-Requested-With":"XMLHttpRequest"};if("GET"!==t&&(u["Content-Type"]="application/x-www-form-urlencoded"),u=n.combineObjects(u,i),n.setRequestHeaders(s,u),s.onload=function(){var e=s.response;200==s.status||201==s.status||204==s.status?(e&&"application/json"==s.getResponseHeader("Content-Type")&&(e=JSON.parse(s.response)),r(e)):(e&&"application/json"==s.getResponseHeader("Content-Type")&&(e=JSON.parse(s.response)),a(e))},s.onerror=function(){return a(new Error("Network error"))},"GET"!==t){var l="";l=n.isContentMultipart(i)?n.payloadForMultipart(o):n.objectToParams(o),s.send(l)}else s.send()})}},{key:"payloadForMultipart",value:function(e){var t=new FormData;return this.buildFormData(t,e),t}},{key:"buildFormData",value:function(e,t,n){var i=this;if(!t||"object"!==(void 0===t?"undefined":o(t))||t instanceof Date||t instanceof File){var r=null==t?"":t;e.append(n,r)}else Object.keys(t).forEach(function(o){i.buildFormData(e,t[o],n?n+"["+o+"]":o)})}},{key:"isContentMultipart",value:function(e){return void 0!==e["Content-Type"]&&/multipart.form-data/.test(e["Content-Type"])}},{key:"combineObjects",value:function(e,t){var n={};return Object.keys(e).forEach(function(t){n[t]=e[t]}),Object.keys(t).forEach(function(e){n[e]=t[e]}),n}},{key:"setRequestHeaders",value:function(e,t){this.isContentMultipart(t)&&delete t["Content-Type"],Object.keys(t).forEach(function(n){e.setRequestHeader(n,t[n])})}},{key:"post",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.ajax(e,"POST",t,n)}},{key:"get",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.ajax(e+"?"+this.objectToParams(t),"GET",{},n)}},{key:"objectToParams",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.keys(e).map(function(i){if("object"===o(e[i])){var r=""===n?i:n+"["+i+"]";return t.objectToParams(e[i],r)}return""===n?i+"="+e[i]:n+"["+i+"]="+e[i]}).join("&")}}]),e}();t.default=r},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"createEvent",value:function(e){var t=e.eventName,n=e.bindedElement,o=void 0;try{o=new Event(t)}catch(e){(o=document.createEvent("Event")).initEvent(t,!0,!0)}n.dispatchEvent(o)}},{key:"createCustomEvent",value:function(e){var t=e.eventName,n=e.bindedElement,o=e.detail,i=void 0;try{i=new CustomEvent(t,{detail:o})}catch(e){(i=document.createEvent("Event")).detail=o,i.initEvent(t,!0,!0)}n.dispatchEvent(i)}}]),e}();t.default=i},34:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(2),a=(o=r)&&o.__esModule?o:{default:o};var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listUrl=t.listUrl||null,this.articleId=t.articleId||null,this.itemSelector=t.itemSelector||null}return i(e,[{key:"getComments",value:function(e){var t=this;return this.params=e,new Promise(function(e,n){if(!t.listUrl||!t.articleId||!t.itemSelector)return n("Nieznana usterka!");(new a.default).get("/ajax/nsk/"+t.listUrl,{article_id:parseInt(t.articleId),limit:parseInt(t.params.limit||1),page:parseInt(t.params.page||1),prev_page_last_id:parseInt(t.params.prevPageLastId||0),version:2}).then(function(n){var o=n.html?n.html:n,i=document.createElement("p");i.innerHTML=o;var r=i.querySelectorAll(t.itemSelector),a=i.querySelector("[data-commnet-total]")||0;a&&(a=parseInt(a.dataset.commnetTotal)),e({comments:r,total:a})})})}}]),e}();t.default=s},38:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=s(n(0)),r=s(n(3)),a=s(n(9));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"defineProps",value:function(){return{sectionElement:null,report_url:""}}},{key:"defineUi",value:function(){return{content:"#"+this.id+"Content",quote:"#"+this.id+"Quote",author:"#"+this.id+"Author",date:"#"+this.id+"Date",reportButton:".js-report-button",actions:"#"+this.id+"Actions"}}},{key:"defineEvents",value:function(){return{"comment-item-change-info":"onCommentItemCustomChangeInfo","click quote":"onQuoteClick","click reportButton":"onReportButtonClick"}}},{key:"onReportButtonClick",value:function(e){var t=e.target.dataset.id,n=this.props.report_url.replace("{id}",t);this.props.clickedElement=e.target,r.default.createCustomEvent({eventName:"comment-report-show",bindedElement:document.querySelector("[data-comment-report]"),detail:{id:t,url:n,sectionElement:this.props.sectionElement,calledElement:this.node}})}},{key:"onQuoteClick",value:function(){if(this.props.sectionElement){var e=this.el.content.querySelector("blockquote"),t=this.el.content.querySelector("p"),n=new Date(this.el.date.getAttribute("datetime")),o=a.default.formatWithDate(n),i=this.el.author.textContent,s="";e&&(s+=this.getBlockquoteContent(e)+"\n\n"),t&&(s+=o+", "+i+":\n "+t.textContent+"\n"),t||e||(s+=o+", "+i+":\n "+this.el.content.textContent+"\n"),r.default.createCustomEvent({eventName:"comment-section-add-quote",bindedElement:this.props.sectionElement,detail:{author:i,content:s,date:n}})}}},{key:"getBlockquoteContent",value:function(e){var t=e.cloneNode(!0),n=t.querySelectorAll("time");for(var o in n)n.hasOwnProperty(o)&&(n[o].textContent="\n"+n[o].getAttribute("datetime"));return t.textContent}},{key:"onCommentItemCustomChangeInfo",value:function(e){this.props.clickedElement.remove();var t=document.createElement("p");t.classList.add("js-message","js-reportState"+e.detail.response.state),t.textContent=e.detail.response.message,this.el.actions.appendChild(t)}}]),t}();t.default=u},9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"timeAgo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,o=Math.abs(t.getTime()-n.getTime())/1e3,i=Math.abs(t.getDate()-n.getDate()),r=Math.abs(t.getMonth()-n.getMonth()),a=Math.abs(t.getFullYear()-n.getFullYear());if(o<60)return"przed chwilą";if(o<120)return"minutę temu";if(o<300)return Math.floor(o/60)+" minuty temu";if(o<3600)return Math.floor(o/60)+" minut temu";if(0===i&&0==r&&0==a)return o<7200?"godzinę temu":o<18e3?Math.floor(o/3600)+" godziny temu":Math.floor(o/3600)+" godzin temu";var s=t<n?t:n,u=s.toLocaleString("pl",{hour:"numeric",minute:"2-digit"});if(0==r&&0==a){if(1===i)return"wczoraj, "+u;if(i<6)return i+" dni temu, "+u}return e.formatWithDate(s)}},{key:"formatWithDate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.toLocaleString("pl",{hour:"numeric",minute:"2-digit"}),o=["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"][e.getMonth()],i=e.getFullYear(),r=e.getDate()+" "+o;return i!=(new Date).getFullYear()&&(r=r+" "+i),t&&(r=r+", "+n),r}}]),e}();t.default=i},97:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=l(n(0)),r=l(n(9)),a=l(n(38)),s=l(n(34)),u=l(n(3));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"defineProps",value:function(){return{section_id:null,list_url:"",article_id:0,limit:25,page:1,format_date_frequency:3e3,total:0}}},{key:"defineUi",value:function(){return{comment:"[data-comment-item]",commentDate:"time[datetime]",content:"#"+this.id+"Content",noteAboutEmpty:"#"+this.id+"NoteAboutEmpty"}}},{key:"defineEvents",value:function(){return{"comment-listing-update":"onCustomListingUpdate","comment-listing-load":"onCustomListingLoad"}}},{key:"afterInit",value:function(){this.el.section=document.getElementById(this.props.section_id),this.items=[],this.elExists.comment&&this.bindItems(this.el.comment),this.commentsUpdateService=new s.default({listUrl:this.props.list_url,articleId:this.props.article_id,itemSelector:this.ui.comment}),this.bindFormatCommentsDate()}},{key:"onCustomListingUpdate",value:function(e){var t=this;this.commentsUpdateService.getComments({page:1,limit:this.props.limit,prevPageLastId:0}).then(function(n){if(t.props.total=n.total,e.detail.replace){for(t.items=[];t.el.content.firstChild;)t.el.content.removeChild(t.el.content.firstChild);t.elExists.comment=!1,t.bindItems(n.comments,"append")}else{var o=t.filterNewCommentsOnFirstPage(n.comments);t.bindItems(o,"prepend")}})}},{key:"onCustomListingLoad",value:function(){var e=this;this.props.page++;var t=this.getLastCommentId();this.commentsUpdateService.getComments({page:this.props.page,limit:this.props.limit,prevPageLastId:t}).then(function(t){e.props.total=t.total,e.bindItems(t.comments,"append")})}},{key:"bindItems",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=[];e.length>0&&(e.forEach(function(e){var i=t.bindItem(e,n);o.push(i)}),0==this.items.length?this.items=o:this.items="prepend"===n?o.concat(this.items):this.items.concat(o),this.el.comment=this.items.map(function(e){return e.node}),this.elExists.comment=!0),this.hideNoteAboutEmpty(),this.bindFormatCommentsDate(),this.sendPageLoadedEvent()}},{key:"bindItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"append"===t&&this.el.content.appendChild(e),"prepend"===t&&(this.elExists.comment?this.el.content.insertBefore(e,this.el.comment[0]):this.el.content.appendChild(e)),null!==t&&(e.classList.add("js-new"),setTimeout(function(){e.classList.add("js-newVisible")},0));var n=new a.default(e.id,"");return n.init({sectionElement:this.el.section,report_url:this.props.report_url}),n}},{key:"sendPageLoadedEvent",value:function(){var e=parseInt(this.props.limit)*parseInt(this.props.page)>parseInt(this.props.total);u.default.createCustomEvent({eventName:"comment-section-page-loaded",bindedElement:this.el.section,detail:{last:e,total:this.props.total}})}},{key:"bindFormatCommentsDate",value:function(){var e=this;this.formatCommentsDateInterval&&(clearInterval(this.formatCommentsDateInterval),this.el.commentDate=this.node.querySelectorAll(this.ui.commentDate)),this.formatCommentsDate(),this.formatCommentsDateInterval=setInterval(function(){e.formatCommentsDate()},this.props.format_date_frequency)}},{key:"formatCommentsDate",value:function(){this.elExists.commentDate&&this.el.commentDate.forEach(function(e){e.textContent=r.default.timeAgo(new Date(e.getAttribute("datetime")))})}},{key:"hideNoteAboutEmpty",value:function(){this.elExists.noteAboutEmpty&&this.el.comment.length>0&&(this.el.noteAboutEmpty.style.display="none")}},{key:"filterNewCommentsOnFirstPage",value:function(e){if(!this.elExists.comment)return e;if(0===e.length)return[];var t=this.getFirstCommentId(),n=[];for(var o in e)if(e.hasOwnProperty(o)){if(parseInt(e[o].dataset.commentId)===parseInt(t))break;n.push(e[o])}return n}},{key:"getFirstCommentId",value:function(){return this.el.comment[0].dataset.commentId||0}},{key:"getLastCommentId",value:function(){if(this.elExists.comment)return 0;var e=this.el.comment[this.el.comment.length-1];return e?e.dataset.commentId:0}}]),t}();t.default=c}})});